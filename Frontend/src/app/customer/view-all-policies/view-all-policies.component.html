<div class="container mt-5">
  <h1 class="text-center mb-4">Available Policy Schemes</h1>

  <!-- Alert for Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger text-center">
    {{ errorMessage }}
  </div>

  <!-- Dropdown for Policy Type -->
  <div class="mb-4">
    <label for="policyType" class="form-label">Filter by Policy Plans</label>
    <select 
      id="policyType" 
      class="form-select" 
      [(ngModel)]="selectedPolicyTypeId" 
      (change)="filterPolicies()">
      <option value="" selected>All Policy Plans</option>
      <option *ngFor="let type of policyTypes" [value]="type.id">{{ type.type }}</option>
    </select>
  </div>

  <!-- Policies -->
  <div class="row">
    <div *ngFor="let policy of filteredPolicies" class="col-md-6 col-lg-4 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-center">{{ policy.name }}</h5>
          <p class="card-text text-truncate" title="{{ policy.description }}">
            {{ policy.description }}
          </p>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <strong>Age Criteria:</strong> {{ policy.minimumAgeCriteria }} - {{ policy.maximumAgeCriteria }}
            </li>
            <li class="list-group-item">
              <strong>Investment:</strong> 
              {{ policy.minimumInvestmentAmount | currency:'INR' }} - 
              {{ policy.maximumInvestmentAmount | currency:'INR' }}
            </li>
            <li class="list-group-item">
              <strong>Term:</strong> {{ policy.minimumPolicyTerm }} - {{ policy.maximumPolicyTerm }} years
            </li>
            <li class="list-group-item">
              <strong>Profit %:</strong> {{ policy.profitPercentage }}%
            </li>
            <li class="list-group-item">
              <strong>Commission %:</strong> {{ policy.commissionPercentage }}%
            </li>
          </ul>

          <div class="mt-4">
            <div class="form-group">
              <div class="mt-3">
                <label for="investmentAmount">Investment Amount</label>
                <input 
                  type="number" 
                  class="form-control" 
                  id="investmentAmount-{{ policy.id }}" 
                  [(ngModel)]="investmentAmount"
                  [min]="policy.minimumInvestmentAmount" 
                  [max]="policy.maximumInvestmentAmount"
                  placeholder="Enter Investment Amount"
                >
              </div>
              <div class="mt-3">
                <label for="investmentAmount">Policy Term</label>
                <input 
                  type="number" 
                  class="form-control" 
                  id="policyTerm-{{ policy.id }}" 
                  [(ngModel)]="policyTerm"
                  [min]="policy.minimumPolicyTerm" 
                  [max]="policy.maximumPolicyTerm"
                  placeholder="Enter Policy term"
                >
              </div>
              <div class="mb-3">
                <label for="installmentType" class="form-label">Installment Type</label>
                <select
                  id="installmentType"
                  class="form-control"
                  [(ngModel)]="installment"
                >
                  <option value="">-- Select Installment Type --</option>
                  <option *ngFor="let type of installmentTypes" [value]="type">
                    {{ type }}
                  </option>
                </select>
              </div>
              <div class="mt-3">
                <button class="btn btn-success" (click)="calculateInvestment(policy)">Calculate</button>
              </div>
              <div class="mt-3">
                <label for="InstallemtnAmount">Installment Amount</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="InstallemtnAmount-{{ policy.id }}" 
                  [value]="InstallemtnAmount"
                  readonly
                >
              </div>
              <div class="mt-3">
                <label for="calculatedAmount">Claim Amount</label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="calculatedAmount-{{ policy.id }}" 
                  [value]="calculatedAmount"
                  readonly
                >
              </div>
            </div>

            <div class="mt-3">
              <button class="btn btn-primary" (click)="buyPolicy(policy)">
                Buy Policy
              </button> 
            </div>

          </div>
    </div>
  </div>
</div>
