<div class="container mt-5">
  <h2>Policy Accounts</h2>

  <div *ngIf="policies.length > 0; else noPolicies">
    <table class="table table-bordered table-striped mt-3">
      <thead class="thead-dark">
        <tr>
          <th scope="col">Sr. No.</th>
          <th scope="col">Policy Name</th>
          <th scope="col">Customer Name</th>
          <th scope="col">Claim Amount</th>
          <th scope="col">Total Amount Paid</th>
          <th scope="col">Term (in years)</th>
          <th scope="col">Status</th>
          <th scope="col">Approval</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let policy of policies; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ policy.policyName }}</td>
          <td>{{ policy.customerName }}</td>
          <td>{{ policy.coverageAmount | currency: 'INR'}}</td>
          <td>{{ policy.totalAmountPaid | currency:'INR' }}</td>
          <td>{{ policy.policyTerm }}</td>
          <td>{{ policy.status }}</td>
          <td>{{ policy.isApproved }}</td>
          <td>
            <a
                routerLink="/employee-view/approve-policy-account-document"
                [queryParams]="{ policyAccountId: policy.id }"
                class="btn btn-secondary btn-sm"
            >
                View Documents
            </a>
            <button
              class="btn btn-success btn-sm mx-2"
              (click)="updateStatus(policy.id, 'Approved', '')"
              [disabled]="policy.isApproved === 'Approved' || policy.isApproved === 'Rejected'"
            >
              Approve
            </button>
            <button
              class="btn btn-danger btn-sm"
              (click)="openRejectionModal(policy.id)"
              [disabled]="policy.isApproved === 'Rejected' || policy.isApproved === 'Approved'"
            >
              Reject
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #noPolicies>
    <p class="text-center">No policies available.</p>
  </ng-template>

  <!-- Rejection Reason Modal -->
  <div *ngIf="isRejectionModalOpen" class="modal show" style="display: block;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Rejection Reason</h5>
          <button type="button" class="btn-close" (click)="closeRejectionModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="rejectionForm" (ngSubmit)="submitRejectionReason()">
            <div class="mb-3">
              <label for="rejectionReason" class="form-label">Reason</label>
              <textarea
                id="rejectionReason"
                class="form-control"
                formControlName="reason"
                rows="4"
                placeholder="Enter rejection reason"
              ></textarea>
              <div *ngIf="rejectionForm.get('reason')?.invalid && rejectionForm.get('reason')?.touched" class="text-danger">
                Rejection reason is required.
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-danger" [disabled]="rejectionForm.invalid">Submit</button>
              <button type="button" class="btn btn-secondary" (click)="closeRejectionModal()">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
